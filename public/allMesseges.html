<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" rel="stylesheet" href="/stylesheets/allMesseges.css">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</head>
<body>

    <!-- Navbar -->
 <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
  <span class="navbar-toggler-icon"></span>
</button>

<div class="collapse navbar-collapse" id="navbarSupportedContent">
  <ul class="navbar-nav md-auto">
    <li class="nav-item active 1">
      <a class="nav-link" href="homepage.html">Home <span class="sr-only">(current)</span></a>
    </li>
  </ul>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item active 2">
      <a class="nav-link" href="/all/messeges">Messeges</a>
    </li>
    <li class="nav-item active 2">
      <a class="nav-link" href="#">My Profile</a>
    </li>
  </ul>
</div>
</nav>
    
<!-- Messeges -->
    <ul class="chatContainer">
        <li class="chat"   data-to="1">Caio</li>
        <hr>
        <li class="chat"   data-to="3">Noah</li>
        <hr>
        <li class="chat"  data-to="5">Elvis</li>
        <hr>
    </ul>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>

     
$.ajax({
    url: "/user",
    method: "GET"
  })
  .then(result => {
      console.log(result);
      let userId = result.user;
      let lis = document.getElementsByClassName("chat")
      for(let i = 0; i < lis.length; i++){
        let to = lis[i].getAttribute("data-to");
        console.log(to);
        let userArray = [userId, to];
        let sortedArray = userArray.sort();
        let msgId = sortedArray[0] + "-" + sortedArray[1];
        lis[i].setAttribute("data-id", msgId);
        console.log(msgId)
        console.log(lis[i]);

    }
  })

        $(".chat").on("click", function(){
            
            var msgId = this.getAttribute("data-id");
            var userTo = this.getAttribute("data-to");
            console.log(msgId);

            
                history.pushState({}, '');
                window.location.replace("/chat/" + msgId + "/" + userTo); 
               
          
        })

    </script>
</body>
</html>